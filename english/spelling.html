<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spelling üêù</title>
  <meta name="description" content="Hear a word, see the definition, and try your best to spell it!">
  <meta name="tags" content="spelling, bee, challenge, typing, keyboard">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/common.css?v=9.1" rel="stylesheet">
  <style>
    
  </style>
</head>
<body>
  <div id="menu" class="panel">
    <h1>Spelling üêù</h1>
    <p>Hear a word, see the definition, and try your best to spell it!</p>
    <a class="big-red btn" id="start" href="#">Go</a>
    <div class="options" style="margin-top: 1em">
      <a class="btn action-leaderboard" href="#">View leaderboard</a>
      <a class="btn" href="/">More games</a>
    </div>
    <p class="panel-controls">
      <label for="difficulty">Difficulty: </label>
      <select id="difficulty" id="modeswitch" autofocus>
        <option value="easy" selected>Easy</option>
      </select>
    </p>
  </div>
  <div id="game" class="panel" style="display:none;">
    <h1 id="question">Word 1</h1>
    <p id="definition">Definition: </p>
    <p id="input">_</p>
    <br>
    <div class="options">
      <a class="btn confirm-action action-cancel" href="#">Menu</a>
      <a class="btn action-check disabled" href="#">Check answer</a>
    </div>
  </div>
  <div id="results" class="panel" style="display:none;">
    <h1>Correct / Incorrect</h1>
    <p id="worddiff"></p>
    <div class="options">
      <a class="btn action-cancel" href="#">Menu</a>
      <a class="btn action-leaderboard" href="#">Next word</a>
    </div>
  </div>
  <div id="leaderboard" class="panel" style="display:none;">
    <h1>Leaderboard</h1>
    <p id="leaderboard-difficulty">
      (Easy)
    </p>
    <table id="board" width="100%">
      <thead>
        <th>Place</th><th>Name</th><th>Score</th>
      </thead>
      <tbody>
        <td>--</td><td>-----</td><td>---</td>
      </tbody>
    </table>
    <br>
    <div class="options">
      <a class="btn action-cancel" href="#">Back</a>
    </div>
  </div>
  <div id="keyboard" style="display:none;">
    <a href="#" class="btn action-toggle-keyboard">‚å®Ô∏è</a>
    <div class="row">
      <a href="#" class="btn action-type">Q</a>
      <a href="#" class="btn action-type">W</a>
      <a href="#" class="btn action-type">E</a>
      <a href="#" class="btn action-type">R</a>
      <a href="#" class="btn action-type">T</a>
      <a href="#" class="btn action-type">Y</a>
      <a href="#" class="btn action-type">U</a>
      <a href="#" class="btn action-type">I</a>
      <a href="#" class="btn action-type">O</a>
      <a href="#" class="btn action-type">P</a>
    </div>
    <div class="row">
      <a href="#" class="btn action-type">A</a>
      <a href="#" class="btn action-type">S</a>
      <a href="#" class="btn action-type">D</a>
      <a href="#" class="btn action-type">F</a>
      <a href="#" class="btn action-type">G</a>
      <a href="#" class="btn action-type">H</a>
      <a href="#" class="btn action-type">J</a>
      <a href="#" class="btn action-type">K</a>
      <a href="#" class="btn action-type">L</a>
    </div>
    <div class="row">
      <a href="#" class="btn action-type">Z</a>
      <a href="#" class="btn action-type">X</a>
      <a href="#" class="btn action-type">C</a>
      <a href="#" class="btn action-type">V</a>
      <a href="#" class="btn action-type">B</a>
      <a href="#" class="btn action-type">N</a>
      <a href="#" class="btn action-type">M</a>
      <a href="#" class="btn action-untype">&lt;&times;</a>
    </div>
  </div>

  <script src="//cdn.yiays.com/jquery-3.6.0.min.js"></script>
  <script src="//cdn.yiays.com/jquery-color.min.js"></script>
  <script src="/common.js?v=11.4"></script>
  <script>
    const words = {
      0: {
        'answer': "A response to a question",
        'brother': "A male sibling",
        'chocolate': "A sweet made of cocoa, butter, and milk",
        'couple': "A group of two",
        'greed': "Selfish desire for something",
        'knit': "Creating clothing and other objects out of wool",
        'maximum': "The most it can possibly be",
        'medal': "A form of badge that marks an achievement",
        'million': "The number 1,000,000",
        'sparkle': "To emit a rapidly changing light"
      },
      1: {
        'acronym': "A sentence where the first letter of each word can spell a word",
        'apricot': "An orange fruit with a core",
        'autumn': "The season in which trees lose their leaves",
        'congratulate': "To praise somebody who has made an achievement",
        'determined': "Possessing or displaying resolve",
        'hackable': "Easily exploited and broken open",
        'labour': "Work that is often physically straining",
        'throwable': "Capable of being tossed",
        'vanity': "To be prideful about your appearance"
        // TODO: find 1 more
      },
      2: {
        'communal': "Shared objects which anyone in a community can share",
        'congratulations': "To praise somebody who has made an achievement",
        'maroon': "A shade of purple and a ship stuck on land",
        'millennium': "A one thousand year anniversary",
        'miscellaneous': "Anything that doesn't fit in other categories",
        'oligarchy': "A small group of people that maintain control over a country",
        'phenomenon': "An unusual happening",
        'spontanaeity': "To be unpredictable and make decisions on a whim"
        // TODO: find 2 more
      }
    }
    let word, input, answers;
    const animparams = {distance: 5, speed: 50, times: 2}

    $().ready(() => {
      $('#modeswitch').on('change', on_modechange);

      $('#start').on('click', newgame);

      $('.action-toggle-keyboard').on('click', toggle_keyboard);

      $('.action-type').on(
        'click',
        (e) => type(e.target.textContent)
      );
      $('.action-untype').on('click', untype);
      init_keyboard_capture();

      $('.action-cancel').on('click', menu);

      $('.action-results').on('click', (e) => {
        e.preventDefault();

        $('#leaderboard').hide();
        $('#results').show();
      })

      $('.action-submit').on('click', checkanswer);

      $('.action-leaderboard').on('click', showleaderboard);

      $('.action-finish').on('click', endgame);
    });

    function on_modechange() {
      word = this.value;
      if(word.length) {
        $('#start,.action-leaderboard').removeClass('disabled');
        if($('#leaderboard').is(':visible')) showleaderboard();
      }
      else {
        $('#start,.action-leaderboard').addClass('disabled');
        if($('#leaderboard').is(':visible')) menu();
      }
    }

    function menu() {
      $('#game,#results,#leaderboard,#keyboard').hide();
      $('#menu').show();
      $('body').removeClass('keyboard');
    }

    function newgame() {
      if(word) {
        $('#menu,#results,#leaderboard').hide();
        input = '';
        $('#input').text('_');
        $('#game,#keyboard').show();
        $('body').addClass('keyboard');
        answers = [];
        $('#question').text(word.toUpperCase());
        resetkeys();
      }
    }

    function resetkeys() {
      keys = {
        'Q':0,'W':0,'E':0,'R':0,'T':0,'Y':0,'U':0,'I':0,'O':0,'P':0,
        'A':0,'S':0,'D':0,'F':0,'G':0,'H':0,'J':0,'K':0,'L':0,
        'Z':0,'X':0,'C':0,'V':0,'B':0,'N':0,'M':0
      }
      for(var i=0; i<word.length; i++) {
        var letter = word.charAt(i).toUpperCase();
        keys[letter] += 1;
      }

      $('.action-type').each((i, el) => {
        $(el).attr('data-count', keys[$(el).text()]);
        if(keys[$(el).text()] > 0)
          $(el).removeClass('disabled');
        else
          $(el).addClass('disabled');
      });

      $('#found').text(answers.join(', ').toUpperCase())
      .animate({scrollTop: $('#found')[0].scrollHeight}, 300);

    }

    function checkanswer() {
      let check = input.toLowerCase();

      if(check == word) {
        $('#game').shake(animparams);
        return;
      }
      if(answers.indexOf(check) >= 0) {
        $('#game').shake(animparams);
        return;
      }
      if(dictionary.indexOf(check) == -1) {
        $('#game').shake(animparams);
        return;
      }
      answers.push(check);
      input = '';
      $('#input').text('_');
      resetkeys();
    }

    function endgame() {
      if(!confirm("After finishing, you can't enter any more words. Continue?")) return;

      $('#menu,#game,#keyboard').hide();
      $('#results').show();
      $('body').removeClass('keyboard');
      
      $('#finalscore').text(answers.length);
      $('#finalscore').prop('title', answers.join('\n'));
      $('#word').text(word);
      let anagrams = answers.filter((e) => {return e.length == word.length});
      $('#anagrams').text(anagrams.length);
      $('#anagrams').prop('title', anagrams.join('\n'));

      submit_highscore(`anagrams_${word}`, `[${anagrams.length},${answers.length}]`, null, 1235);
    }

    function showleaderboard() {
      $('#results,#menu,#game,#keyboard').hide();
      $('#leaderboard').show();
      $('body').removeClass('keyboard');

      $('#leaderboard-word').text(`(${word.toUpperCase()})`);

      get_leaderboard(`anagrams_${word}`,
                      result_converter=(value) => `${value[0]} Anagram(s), ${value[1]} Word(s)`,
                      sorter=(a,b) => (a[2][0]===b[2][0])?b[2][1]-a[2][1]:b[2][0]-a[2][0]);
    }

    function type(letter) {
      if(keys[letter] > 0) {
        input += letter;
        $('#input').text(input + '_');

        keys[letter] -= 1
        $(`.action-type:contains('${letter}')`).attr('data-count', keys[letter]);
        if(keys[letter] <= 0) {
          $(`.action-type:contains('${letter}')`).addClass('disabled');
        }
      }else{
        $('#game').shake(animparams);
      }
    }
    function untype() {
      if (input.length) {
        var letter = input.charAt(input.length - 1);
        input = input.slice(0, -1);
        keys[letter] += 1;
        $(`.action-type:contains('${letter}')`).attr('data-count', keys[letter]);
        $(`.action-type:contains('${letter}')`).removeClass('disabled');
        $('#input').text(input + '_');
      } else {
        $('#game').shake(animparams);
      }
    }
  </script>
</body>
</html>